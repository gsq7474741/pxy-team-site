# 系统架构概述

本文档详细描述 PXY Team Site 的整体系统架构设计。

## 架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              用户端                                      │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │
│  │   桌面浏览器     │  │   移动端浏览器    │  │   Strapi 管理员  │          │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘          │
└───────────┼─────────────────────┼────────────────────┼──────────────────┘
            │                     │                    │
            ▼                     ▼                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        阿里云函数计算 (FC)                               │
│  ┌─────────────────────────────────────────────────────────────────────┐│
│  │                       域名与证书配置                                 ││
│  │   prof-peng.team (前端)        cms.prof-peng.team (后端管理)         ││
│  └─────────────────────────────────────────────────────────────────────┘│
│                                                                         │
│  ┌────────────────────────────┐    ┌────────────────────────────────┐  │
│  │     前端函数                │    │       后端函数                  │  │
│  │   ┌──────────────────────┐ │    │  ┌──────────────────────────┐  │  │
│  │   │     Next.js 15       │ │    │  │      Strapi 5            │  │  │
│  │   │   (standalone mode)  │ │    │  │   (Headless CMS)         │  │  │
│  │   │                      │ │    │  │                          │  │  │
│  │   │  • SSR 服务端渲染     │ │◄───┤  │  • REST API              │  │  │
│  │   │  • ISR 增量静态再生   │ │    │  │  • 内容管理后台           │  │  │
│  │   │  • API Routes        │ │    │  │  • i18n 多语言            │  │  │
│  │   └──────────────────────┘ │    │  └──────────────────────────┘  │  │
│  │         Port: 3000         │    │         Port: 1337             │  │
│  └────────────────────────────┘    └─────────────┬──────────────────┘  │
└──────────────────────────────────────────────────┼──────────────────────┘
                                                   │
                                    ┌──────────────┴──────────────┐
                                    │                             │
                                    ▼                             ▼
                        ┌─────────────────────┐     ┌─────────────────────┐
                        │    云数据库          │     │    阿里云 OSS        │
                        │    PostgreSQL       │     │    媒体存储          │
                        │                     │     │                     │
                        │  • 内容数据存储      │     │  • 图片、文件存储    │
                        │  • 多语言内容       │     │  • CDN 加速分发      │
                        │  • 用户认证数据     │     │  • 自动生成缩略图    │
                        └─────────────────────┘     └─────────────────────┘
```

## 核心组件

### 1. 前端应用 (Next.js)

**职责**：
- 用户界面渲染
- 服务端数据获取
- 国际化处理
- SEO 优化

**关键特性**：
- **SSR** - 服务端渲染，首屏加载快
- **ISR** - 增量静态再生，平衡性能和实时性
- **App Router** - Next.js 15 的现代路由系统

### 2. 后端应用 (Strapi)

**职责**：
- 内容管理 (CMS)
- REST API 提供
- 用户认证
- 媒体文件管理

**关键特性**：
- **Headless CMS** - 内容与展示分离
- **可视化编辑** - 非技术人员可操作
- **i18n** - 原生多语言支持

### 3. 数据库 (PostgreSQL)

**存储内容**：
- 所有内容数据
- 多语言翻译
- 用户账号
- API Token

### 4. 对象存储 (OSS)

**存储内容**：
- 图片文件
- PDF 文件
- 其他媒体资源

## 请求流程

### 页面请求流程

```
1. 用户访问 prof-peng.team/research
2. 请求到达阿里云 FC 前端函数
3. Next.js 处理请求：
   a. 检查是否有 ISR 缓存
   b. 如果需要，调用 Strapi API
4. Strapi 查询 PostgreSQL 获取数据
5. Next.js 渲染 HTML 返回给用户
6. 用户浏览器收到完整 HTML
7. React 水合 (Hydration)，页面变为可交互
```

### API 请求流程

```
1. 客户端组件需要数据
2. 调用 strapi-client.ts 中的 API 方法
3. 请求发送到 cms.prof-peng.team
4. Strapi 处理请求，查询数据库
5. 返回 JSON 数据
6. transformers.ts 转换数据格式
7. 组件使用转换后的数据渲染
```

### ISR 重验证流程

```
1. 管理员在 Strapi 更新内容
2. Strapi Webhook 触发
3. 调用前端 /api/revalidate 接口
4. Next.js 清除相关页面缓存
5. 下次用户访问时重新生成页面
```

## 安全设计

### API 安全

- Strapi API 默认使用权限控制
- 公开内容通过 `public` 角色访问
- 管理操作需要认证

### 环境变量安全

- 敏感信息存储在 GitHub Secrets
- 部署时通过环境变量注入
- 前端只暴露 `NEXT_PUBLIC_` 前缀变量

### 媒体安全

- OSS 使用独立的 Access Key
- 支持 HTTPS 传输
- 可配置访问权限

## 扩展性考虑

### 水平扩展

- 函数计算自动扩缩容
- 数据库可升级规格
- OSS 天然支持高并发

### 功能扩展

- Strapi 支持自定义 API
- 前端可添加新页面和组件
- 支持添加新的内容类型

## 监控与日志

- 阿里云 FC 提供函数执行日志
- 可集成云监控告警
- 前端可添加错误上报

## 下一步

- 了解 [Monorepo 结构](/architecture/monorepo)
- 查看 [数据流设计](/architecture/data-flow)
